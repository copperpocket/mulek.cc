---
import MainLayout from "@/layouts/MainLayout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import BackgroundParticles from "@/components/BackgroundParticles.astro";
import "@/styles/global.css";

import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");

// Sort posts by newest first
allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const pageTitle = "Blog Archive";
---

<MainLayout title={pageTitle}>
  <BackgroundParticles minHeight="0" maxHeight="100%" particleCount={150} />
  <Header />

  <div class="relative z-10 pt-20 pb-16 min-h-screen">
    <div class="container mx-auto px-4">
      <section class="max-w-3xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-10 text-neutral-800 dark:text-neutral-200">
          {pageTitle}
        </h1>

        {allPosts.length > 0 ? (
          <ul role="list" class="space-y-6">
            {allPosts.map(({ id, data }) => (
              <li
                class="post-preview bg-white dark:bg-neutral-900 rounded-lg shadow-xl p-6 transition-all duration-300 hover:shadow-2xl hover:scale-[1.01]"
              >
                <a href={`/blog/${id}`} class="block">
                  <h2 class="text-xl font-semibold mb-2 text-accent">{data.title}</h2>
                  <p class="text-sm text-neutral-500 dark:text-neutral-400">
                    Published: {data.pubDate.toLocaleDateString()}
                  </p>
                  <p class="mt-3 text-neutral-700 dark:text-neutral-300">{data.description}</p>
                </a>
              </li>
            ))}
          </ul>
        ) : (
          <div class="text-center py-10 text-neutral-600 dark:text-neutral-400">
            <p>No blog posts found.</p>
          </div>
        )}
      </section>
    </div>
  </div>

  <Footer />
</MainLayout>
